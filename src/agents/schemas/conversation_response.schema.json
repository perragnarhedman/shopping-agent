{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": [
    "intent",
    "confidence",
    "user_message_understood",
    "conversation_response",
    "next_action",
    "needs_human_escalation"
  ],
  "properties": {
    "intent": {
      "type": "string",
      "enum": ["shopping", "browsing", "help", "out_of_scope", "clarification_needed"]
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    },
    "user_message_understood": {
      "type": "string",
      "minLength": 1
    },
    "extracted_info": {
      "type": ["object", "null"],
      "properties": {
        "shopping_list": {
          "type": ["array", "null"],
          "items": {"type": "string"}
        },
        "quantities": {
          "type": ["object", "null"]
        },
        "preferences": {
          "type": ["object", "null"]
        },
        "constraints": {
          "type": ["object", "null"]
        }
      }
    },
    "clarification_questions": {
      "type": "array",
      "items": {"type": "string"}
    },
    "agent_delegation": {
      "type": "object",
      "required": ["required"],
      "properties": {
        "required": {"type": "boolean"},
        "agent_type": {
          "type": ["string", "null"],
          "enum": ["authentication", "shopping", null]
        },
        "task_payload": {
          "type": ["object", "null"]
        }
      }
    },
    "conversation_response": {
      "type": "string",
      "minLength": 1
    },
    "next_action": {
      "type": "string",
      "enum": ["await_user_input", "delegate_to_agent", "end_session"]
    },
    "needs_human_escalation": {
      "type": "boolean"
    }
  }
}

