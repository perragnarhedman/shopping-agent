Goal: Ensure the user is authenticated on coop.se. If already logged in, do nothing.

Params (provided securely by the runtime, NEVER echo or log secrets):
- loginId: "{{loginId}}"         // e.g., email or phone; safe to use in selectors
- passwordSecretRef: "{{secretRef}}" // secret handle; you receive the password via secure tool/context

Plan:
0) Clear overlays:
   - Call accept_cookies and proceed regardless of whether a click was needed. This ensures the cookie overlay does not intercept clicks.
1) Detect logged-in state:
   - Look for account indicator in header/menu: texts like "Mina sidor", "Mitt konto", "Logga ut", user avatar/name.
   - If found → return status "already".
2) Initiate login (semantic tools only):
   - Click "Logga in" (role=button/link, accessible name ~ /Logga in/i) using click_text or click_role.
   - Wait for login form/modal.
   - Default path: click "Med e‑post" (or visible text ~ /Med e-post|E-post/). Do NOT choose BankID unless explicitly requested or email path fails.
3) Fill credentials (DO NOT echo password in any output or logs):
   - Username: use fill_label or fill_role to enter {{loginId}}.
   - Password: request the password using get_secret(name={{secretRef}}) and then fill the password field via fill_label or fill_role (never print the secret).
   - Submit: click the login/submit button via click_text/click_role or press_key("Enter").
4) Handle outcomes:
   - Success: account indicator visible; set status "logged_in".
   - If email flow is unavailable or fails with a clear prompt requiring BankID:
     - Click the button "Med BankID" to open the BankID flow.
     - Wait until the BankID page/prompt is visible (e.g., text contains "BankID" or a QR prompt such as "Skanna QR-kod" / "Öppna BankID-appen"). Use timeout_ms.
     - Take a screenshot with tag "bankid_qr" to logs/bankid_qr.png.
     - Call request_input(kind="bankid_done", prompt="Please scan the QR code with your BankID app and confirm when authentication is complete.", timeout_seconds=300).
     - After receiving confirmation, verify logged-in state (check for account indicator).
     - If verified: set status "logged_in"; otherwise set status "failed" with error.
   - Failure: visible error message; set status "failed"; include terse error (no secrets).

Modals (must resolve before continuing)
- If a dialog is present (auto_observe.modal_present): use modal_* tools to resolve it.
- For postcode/store selection: get_config(key="stores.coop_se.default_postcode") → modal_fill_label("Postnummer", <value>) → modal_click_text("Fortsätt") → wait_network_idle.
- Do not finalize while any modal is present.

Timing:
- Use timeout_ms (milliseconds) for actions. Prefer 20000–30000ms when network updates are expected.

Return the **Authenticate/Login** schema.
